<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì ì‹¬ë©”ë‰´ ì„ íƒê¸°</title>
  <style>
    :root{
      --bg:#0b1020; /* deep slate */
      --card:#121834;
      --muted:#9aa3b2;
      --text:#e9edf5;
      --accent:#7aa2ff;
      --accent-2:#9ef0c0;
      --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg, #0b1020, #0a0f1a 40%, #0b1020);
      color:var(--text); font-family:-apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo','Noto Sans KR', Segoe UI, Roboto, Helvetica, Arial, "ë§‘ì€ ê³ ë”•", sans-serif;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .app{width:min(980px, 100%);}
    .card{
      background:rgba(18,24,52,.9); border:1px solid rgba(255,255,255,.06);
      box-shadow:0 10px 30px rgba(0,0,0,.4); border-radius:24px; padding:20px; backdrop-filter: blur(8px);
    }
    header{display:flex; align-items:center; gap:16px; flex-wrap:wrap;}
    h1{font-size:clamp(20px, 2vw + 12px, 32px); margin:0; letter-spacing:.2px}
    .sub{color:var(--muted); font-size:14px}

    .result{
      margin:18px 0 12px; background:linear-gradient(135deg, #1c244d, #0e1430);
      border:1px solid rgba(255,255,255,.06); border-radius:20px; padding:22px;
      display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap;
    }
    .picked{font-size:clamp(28px, 4vw + 8px, 44px); font-weight:800; letter-spacing:.5px}
    .hint{color:var(--muted); font-size:13px}

    .controls{display:flex; gap:10px; flex-wrap:wrap}
    button{
      appearance:none; border:none; cursor:pointer; border-radius:14px; padding:12px 16px; font-weight:700; color:#0b1020;
      transition:transform .04s ease, filter .2s ease, box-shadow .2s ease; box-shadow:0 6px 16px rgba(0,0,0,.25);
    }
    button:hover{filter:brightness(1.05)}
    button:active{transform:translateY(1px)}
    .primary{background:var(--accent)}
    .secondary{background:var(--accent-2)}
    .ghost{background:#e4ecff; color:#102040}
    .danger{background:var(--danger); color:white}

    .layout{display:grid; grid-template-columns: 1.2fr .8fr; gap:16px; margin-top:12px}
    @media (max-width: 860px){ .layout{grid-template-columns:1fr} }

    .panel{background:rgba(18,24,52,.7); border:1px solid rgba(255,255,255,.06); border-radius:18px; padding:16px}
    .panel h3{margin:0 0 12px; font-size:16px; color:#cbd6ff}

    .menu-list{display:grid; grid-template-columns:repeat(auto-fill, minmax(180px,1fr)); gap:10px}
    .item{
      display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px; background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.06);
    }
    .item input{accent-color:var(--accent)}

    .toolbar{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px}

    .history{display:flex; flex-direction:column; gap:8px}
    .pill{display:inline-flex; align-items:center; gap:8px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); padding:8px 12px; border-radius:999px; width:fit-content}
    .pill small{color:var(--muted)}

    .kbd{border:1px solid rgba(255,255,255,.2); background:rgba(255,255,255,.06); padding:2px 6px; border-radius:6px; font-size:12px}
    .footer{color:var(--muted); font-size:12px; margin-top:8px}
    .spacer{flex:1}
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <header>
        <h1>ì ì‹¬ë©”ë‰´ ì„ íƒê¸°</h1>
        <div class="sub">ì²´í¬ëœ ë©”ë‰´ ì¤‘ í•˜ë‚˜ë¥¼ ëœë¤ìœ¼ë¡œ ê³¨ë¼ë“œë ¤ìš”. <span class="kbd">R</span> í‚¤ë¡œë„ ì¶”ì²œ!</div>
        <div class="spacer"></div>
        <div class="controls">
          <button id="btn-pick" class="primary" title="ì„ íƒëœ ë©”ë‰´ ì¤‘ì—ì„œ ì¶”ì²œ">ëœë¤ ì¶”ì²œ</button>
          <button id="btn-reroll" class="ghost" title="ë°©ê¸ˆ ì¶”ì²œì—ì„œ ë‹¤ì‹œ">ë‹¤ì‹œ ë½‘ê¸°</button>
          <button id="btn-copy" class="secondary" title="ì¶”ì²œ ê²°ê³¼ ë³µì‚¬">ê²°ê³¼ ë³µì‚¬</button>
          <button id="btn-reset" class="danger" title="ì œì™¸ ì´ˆê¸°í™”">ì œì™¸ ì´ˆê¸°í™”</button>
        </div>
      </header>

      <section class="result">
        <div>
          <div class="picked" id="picked">ë©”ë‰´ë¥¼ ê³¨ë¼ë³¼ê¹Œìš”? ğŸ½ï¸</div>
          <div class="hint">ì²´í¬ ë°•ìŠ¤ë¡œ ì œì™¸/í¬í•¨ì„ ì¡°ì •í•  ìˆ˜ ìˆì–´ìš”.</div>
        </div>
      </section>

      <div class="layout">
        <section class="panel">
          <div class="toolbar">
            <button id="btn-all" class="ghost">ì „ì²´ ì„ íƒ</button>
            <button id="btn-none" class="ghost">ì „ì²´ í•´ì œ</button>
            <button id="btn-invert" class="ghost">ì„ íƒ ë°˜ì „</button>
          </div>
          <h3>ë©”ë‰´ ëª©ë¡</h3>
          <div class="menu-list" id="menu-list"></div>
          <div class="footer">ì²´í¬ëœ í•­ëª©ë§Œ í›„ë³´ì— í¬í•¨ë©ë‹ˆë‹¤.</div>
        </section>

        <section class="panel">
          <h3>íˆìŠ¤í† ë¦¬</h3>
          <div class="history" id="history"></div>
          <div class="footer">ìµœê·¼ 10ê°œê¹Œì§€ ì €ì¥ë©ë‹ˆë‹¤(ë¸Œë¼ìš°ì € ë¡œì»¬ ì €ì¥ì†Œ).</div>
        </section>
      </div>
    </div>
  </div>

  <script>
    const MENUS = [
      'ì¹¼êµ­ìˆ˜','ê´‘í™”ë¬¸ ê¹€ì¹˜ì°Œê°œ','ì œì£¼ ê¹€ì¹˜ì°Œê²Œ','ë¼ˆë‹¤ê·€í•´ì¥êµ­','ì½©ë‚˜ë¬¼êµ­ë°¥','í™©íƒœí•´ì¥êµ­','êµ¬ë£¡','ì‚¼ì‚°êµ­ìˆ˜','ë¶€ì‚°ë°€ë©´','ì½©êµ­ìˆ˜','ë¶„ì‹','ë§¥ë„ë‚ ë“œ','í™ìµëˆê¹ŒìŠ¤'
    ];

    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));

    const listEl = $('#menu-list');
    const pickedEl = $('#picked');
    const historyEl = $('#history');

    const LS_KEYS = {
      checked: 'lunchpicker.checked',
      history: 'lunchpicker.history'
    };

    function loadChecked(){
      try{ return JSON.parse(localStorage.getItem(LS_KEYS.checked)) ?? null }catch{ return null }
    }
    function saveChecked(state){
      localStorage.setItem(LS_KEYS.checked, JSON.stringify(state));
    }
    function loadHistory(){
      try{ return JSON.parse(localStorage.getItem(LS_KEYS.history)) ?? [] }catch{ return [] }
    }
    function saveHistory(hist){
      localStorage.setItem(LS_KEYS.history, JSON.stringify(hist.slice(0,10)));
    }

    function renderList(){
      const saved = loadChecked();
      listEl.innerHTML = '';
      MENUS.forEach((name, i)=>{
        const id = 'm_'+i;
        const item = document.createElement('label');
        item.className = 'item';
        item.innerHTML = `
          <input type="checkbox" id="${id}" ${(!saved || saved[i] !== false) ? 'checked' : ''} />
          <span>${name}</span>
        `;
        listEl.appendChild(item);
      });
      // Persist on change
      listEl.addEventListener('change', persistChecked, {once:true});
    }

    function persistChecked(){
      const states = $$('.item input', listEl).map(chk => chk.checked);
      saveChecked(states);
      // reattach after first event listener is consumed
      listEl.addEventListener('change', persistChecked, {once:true});
    }

    function getSelected(){
      return $$('.item', listEl)
        .map((el, i)=>({name: MENUS[i], checked: $('input', el).checked}))
        .filter(x=>x.checked)
        .map(x=>x.name);
    }

    function animatePick(candidates, final){
      const duration = 1000; // ms
      const start = performance.now();
      let raf;
      function step(t){
        const p = Math.min(1, (t - start) / duration);
        // Ease-out
        const eased = 1 - Math.pow(1 - p, 3);
        const idx = Math.floor(eased * 24) % candidates.length;
        pickedEl.textContent = candidates[idx] + 'â€¦';
        if(p < 1){ raf = requestAnimationFrame(step); }
        else { pickedEl.textContent = final; }
      }
      cancelAnimationFrame(raf);
      raf = requestAnimationFrame(step);
    }

    function pick(){
      const candidates = getSelected();
      if(candidates.length === 0){
        alert('ì„ íƒëœ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤. ì²´í¬ë°•ìŠ¤ì—ì„œ í›„ë³´ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
        return null;
      }
      const i = Math.floor(Math.random() * candidates.length);
      const choice = candidates[i];
      animatePick(candidates, choice);
      return choice;
    }

    function addHistory(item){
      if(!item) return;
      const hist = loadHistory();
      const ts = new Date();
      hist.unshift({ item, ts: ts.toISOString() });
      saveHistory(hist);
      renderHistory();
    }

    function renderHistory(){
      const hist = loadHistory();
      historyEl.innerHTML = '';
      hist.forEach(h => {
        const d = new Date(h.ts);
        const el = document.createElement('div');
        el.className = 'pill';
        el.innerHTML = `<strong>${h.item}</strong><small>${d.toLocaleString('ko-KR')}</small>`;
        historyEl.appendChild(el);
      });
    }

    // Controls
    $('#btn-pick').addEventListener('click', ()=>{
      const c = pick();
      addHistory(c);
    });
    $('#btn-reroll').addEventListener('click', ()=>{
      const candidates = getSelected();
      if(candidates.length === 0) return alert('ì„ íƒëœ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.');
      const prev = pickedEl.textContent.replace('â€¦','');
      let next = prev;
      if(candidates.length === 1){ next = candidates[0]; }
      else{
        while(next === prev){ next = candidates[Math.floor(Math.random()*candidates.length)]; }
      }
      animatePick(candidates, next);
      addHistory(next);
    });
    $('#btn-copy').addEventListener('click', async ()=>{
      const txt = pickedEl.textContent.trim();
      if(!txt || txt.includes('ë©”ë‰´ë¥¼ ê³¨ë¼ë³¼ê¹Œìš”')) return alert('ì•„ì§ ì¶”ì²œëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
      try{ await navigator.clipboard.writeText(txt); alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤: '+txt) }catch{ alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ ì£¼ì„¸ìš”.'); }
    });
    $('#btn-reset').addEventListener('click', ()=>{
      if(!confirm('ì œì™¸ ìƒíƒœë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”? ëª¨ë“  ë©”ë‰´ê°€ ë‹¤ì‹œ í¬í•¨ë©ë‹ˆë‹¤.')) return;
      localStorage.removeItem(LS_KEYS.checked);
      renderList();
    });

    $('#btn-all').addEventListener('click', ()=>{
      $$('.item input', listEl).forEach(i=>i.checked = true);
      persistChecked();
    });
    $('#btn-none').addEventListener('click', ()=>{
      $$('.item input', listEl).forEach(i=>i.checked = false);
      persistChecked();
    });
    $('#btn-invert').addEventListener('click', ()=>{
      $$('.item input', listEl).forEach(i=>i.checked = !i.checked);
      persistChecked();
    });

    // Keyboard shortcut: R to pick
    document.addEventListener('keydown', (e)=>{
      if(e.key.toLowerCase() === 'r'){ $('#btn-pick').click(); }
    });

    // Init
    renderList();
    renderHistory();
  </script>
</body>
</html>
