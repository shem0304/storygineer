<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì ì‹¬ë©”ë‰´ ì„ íƒê¸° Â· ë©€í‹° ìœ ì € Â· ë§¤ì¼ ë‹¬ë¼ìš”</title>
  <style>
    :root{--bg:#0b0d12;--card:#12151d;--sub:#8b95a7;--text:#e6e9ef;--acc:#4da3ff;--mut:#2a2f3a;--good:#38c172;--bad:#ef5753}
    *{box-sizing:border-box}body{margin:0;background:linear-gradient(180deg,#0b0d12,#0f1320);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,Noto Sans KR,sans-serif}
    .wrap{max-width:980px;margin:32px auto;padding:0 16px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:22px;margin:0}
    .card{background:var(--card);border:1px solid var(--mut);border-radius:16px;padding:16px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1 1 300px}
    label{font-weight:600}
    input[type="text"], input[type="date"], textarea{width:100%;background:#0e1118;border:1px solid var(--mut);color:var(--text);padding:10px 12px;border-radius:12px}
    textarea{min-height:90px}
    .btn{appearance:none;border:1px solid var(--mut);background:#121826;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;transition:.15s;font-weight:600}
    .btn:hover{transform:translateY(-1px);border-color:var(--acc)}
    .btn.primary{background:var(--acc);color:#07121e;border-color:transparent}
    .btn.ghost{background:transparent}
    .pill{display:inline-flex;align-items:center;gap:8px;background:#0e131d;border:1px solid var(--mut);padding:6px 10px;border-radius:999px}
    .pill button{border:none;background:transparent;color:var(--sub);cursor:pointer}
    .muted{color:var(--sub)}
    ul.people{display:flex;flex-wrap:wrap;gap:8px;padding:0;margin:8px 0 0;list-style:none}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .result{background:#0e131b;border:1px dashed var(--mut);padding:12px 14px;border-radius:12px}
    .result h3{margin:0 0 8px;font-size:16px}
    .tag{display:inline-block;border:1px solid var(--mut);padding:2px 8px;border-radius:999px;font-size:12px;color:var(--sub)}
    details{border:1px solid var(--mut);border-radius:12px;padding:10px 12px}
    summary{cursor:pointer;font-weight:700}
    .footer{margin-top:18px;color:var(--sub);font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ğŸ± ì ì‹¬ë©”ë‰´ ì„ íƒê¸° <span class="muted">â€” ì—¬ëŸ¬ ëª… / ë‚ ì§œë³„ ìë™ ë³€ê²½</span></h1>
      <div class="muted">Made for ì—°êµ¬ì‹¤ íŒ€ ğŸ§ª</div>
    </header>

    <div class="row">
      <section class="card col" aria-label="ë‚ ì§œ ë° ì˜µì…˜">
        <div class="row">
          <div class="col">
            <label for="date">ë‚ ì§œ</label>
            <input id="date" type="date" />
          </div>
          <div class="col">
            <label for="unique">ì˜µì…˜</label>
            <div class="row">
              <label class="pill"><input id="unique" type="checkbox" checked/> ì¤‘ë³µ ì—†ì´ ë°°ì •</label>
            </div>
          </div>
        </div>
        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
          <button id="generate" class="btn primary">ì˜¤ëŠ˜ ë©”ë‰´ ë½‘ê¸°</button>
          <button id="shuffle" class="btn">ë‹¤ì‹œ ì„ê¸°</button>
          <button id="clearHistory" class="btn ghost">ìµœê·¼ ê¸°ë¡ ì§€ìš°ê¸°</button>
        </div>
      </section>

      <section class="card col" aria-label="ì‚¬ëŒ ì¶”ê°€">
        <label for="personName">ì ì‹¬ ë¨¹ëŠ” ì‚¬ëŒ ì¶”ê°€</label>
        <div class="row">
          <input id="personName" type="text" placeholder="ì´ë¦„ ì…ë ¥ í›„ ì¶”ê°€" />
          <button id="addPerson" class="btn">ì¶”ê°€</button>
        </div>
        <ul id="people" class="people"></ul>
        <div class="muted" style="margin-top:6px">ì‚¬ëŒ ëª©ë¡ì€ ë¸Œë¼ìš°ì €ì— ì €ì¥ë©ë‹ˆë‹¤ (ë¡œì»¬ ì €ì¥ì†Œ).</div>
      </section>
    </div>

    <section class="card" aria-label="ê²°ê³¼">
      <div class="row" style="align-items:center;justify-content:space-between">
        <h2 style="margin:0">ê²°ê³¼</h2>
        <span class="tag" id="todayTag"></span>
      </div>
      <div id="results" class="grid" style="margin-top:10px"></div>
    </section>

    <details style="margin-top:16px" class="card">
      <summary>ê³ ê¸‰ ì„¤ì • Â· ë©”ë‰´ í’€ ìˆ˜ì •</summary>
      <div class="row" style="margin-top:10px">
        <div class="col">
          <label for="menuPool">ë©”ë‰´ í’€ (ì‰¼í‘œ êµ¬ë¶„, ì¤„ë°”ê¿ˆ ê°€ëŠ¥)</label>
          <textarea id="menuPool"></textarea>
        </div>
      </div>
      <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
        <button id="resetMenu" class="btn ghost">ê¸°ë³¸ ë©”ë‰´ë¡œ ë˜ëŒë¦¬ê¸°</button>
        <button id="saveMenu" class="btn">ë©”ë‰´ í’€ ì €ì¥</button>
      </div>
    </details>

    <div class="footer">â“˜ ê°™ì€ ë‚ ì§œì—ì„  ê°™ì€ ê²°ê³¼ê°€ ì¬í˜„ë˜ë©°, ë‚ ì§œê°€ ë°”ë€Œë©´ ìë™ìœ¼ë¡œ ë‹¤ë¥¸ ì¡°í•©ì´ ë‚˜ì˜µë‹ˆë‹¤. (ì‹œë“œ ê¸°ë°˜ ì…”í”Œ)</div>
  </div>

<script>
// ---------- ìœ í‹¸: ì‹œë“œ ê¸°ë°˜ RNG & ì…”í”Œ ----------
function cyrb128(str){
  let h1 = 1779033703, h2 = 3144134277, h3 = 1013904242, h4 = 2773480762;
  for(let i=0, k; i<str.length; i++){
    k = str.charCodeAt(i);
    h1 = h2 ^ Math.imul(h1 ^ k, 597399067);
    h2 = h3 ^ Math.imul(h2 ^ k, 2869860233);
    h3 = h4 ^ Math.imul(h3 ^ k, 951274213);
    h4 = h1 ^ Math.imul(h4 ^ k, 2716044179);
  }
  h1 = Math.imul(h3 ^ (h1>>>18), 597399067);
  h2 = Math.imul(h4 ^ (h2>>>22), 2869860233);
  h3 = Math.imul(h1 ^ (h3>>>17), 951274213);
  h4 = Math.imul(h2 ^ (h4>>>19), 2716044179);
  return [(h1^h2^h3^h4)>>>0, (h2^h1)>>>0, (h3^h1)>>>0, (h4^h1)>>>0];
}
function mulberry32(a){
  return function(){
    var t = a += 0x6D2B79F5;
    t = Math.imul(t ^ t >>> 15, t | 1);
    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  }
}
function seededShuffle(array, seedStr){
  const seed = cyrb128(seedStr)[0];
  const rand = mulberry32(seed);
  const a = array.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(rand()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

// ---------- ê¸°ë³¸ ë©”ë‰´ í’€ ----------
const DEFAULT_MENUS = [
  "ê¹€ì¹˜ì°Œê°œ","ëœì¥ì°Œê°œ","ë¹„ë¹”ë°¥","ë¶ˆê³ ê¸°","ì œìœ¡ë³¶ìŒ","ëƒ‰ë©´","ì¹¼êµ­ìˆ˜","ê¹€ë°¥","ë–¡ë³¶ì´","ìˆœëŒ€êµ­",
  "ë¶€ëŒ€ì°Œê°œ","ê°ìíƒ•","ì‚¼ê²¹ì‚´ë®ë°¥","ì¹˜í‚¨","í”¼ì","íŒŒìŠ¤íƒ€","í–„ë²„ê±°","ìƒŒë“œìœ„ì¹˜","ìƒëŸ¬ë“œ","ì´ˆë°¥",
  "ëˆì¹´ì¸ ","ë¼ë©˜","ìš°ë™","ì§œì¥ë©´","ì§¬ë½•","íƒ•ìˆ˜ìœ¡","ë§ˆë¼íƒ•","í› ê¶ˆ","ìŒ€êµ­ìˆ˜(ë² íŠ¸ë‚¨)","íŒŸíƒ€ì´",
  "ì¹´ë ˆ","ë‚˜ì‹œê³ ë­","ë¶„ì§œ","ê·œë™","ê°€ì¸ ë™","í¬ì¼€","ë‘ë¶€ë®ë°¥","ë¹„ê±´ë¶ˆê³ ê¸°","ìˆœë‘ë¶€ì°Œê°œ","í•´ì¥êµ­",
  "ì­ˆê¾¸ë¯¸ë³¶ìŒ","ë‚™ì§€ë®ë°¥","ë„ì‹œë½","ì¹¼ë¹„ë¹”ë©´","ë¬¼ë¹„ë¹”ë©´","ì†Œë°”","ë°”ì§ˆí˜ìŠ¤í† íŒŒìŠ¤íƒ€","ë¦¬ì¡°ë˜","ë¶€ë¦¬ë˜",
  "íƒ€ì½”","ì¼€ë°¥","íŒŒë‹ˆë‹ˆ","ì¿ ìŠ¤ì¿ ìŠ¤","ë³¶ìŒë°¥","ê°ˆë¹„íƒ•","ì„¤ë íƒ•","ì½©ë‚˜ë¬¼êµ­ë°¥","ë¹„ì§€ì°Œê°œ","ë©”ë°€êµ­ìˆ˜"
];

// ---------- ìƒíƒœ & ì €ì¥ ----------
const LS_KEYS = {PEOPLE:'lunch.people', MENU:'lunch.menuPool', HISTORY:'lunch.history'};
function loadPeople(){
  try{ return JSON.parse(localStorage.getItem(LS_KEYS.PEOPLE))||[] }catch(e){ return [] }
}
function savePeople(list){ localStorage.setItem(LS_KEYS.PEOPLE, JSON.stringify(list)); }
function loadMenuPool(){
  try{
    const raw = localStorage.getItem(LS_KEYS.MENU);
    if(!raw) return DEFAULT_MENUS.slice();
    const arr = JSON.parse(raw);
    return Array.isArray(arr) && arr.length ? arr : DEFAULT_MENUS.slice();
  }catch(e){ return DEFAULT_MENUS.slice() }
}
function saveMenuPool(arr){ localStorage.setItem(LS_KEYS.MENU, JSON.stringify(arr)); }
function saveHistory(dateStr, assignment){
  const hist = JSON.parse(localStorage.getItem(LS_KEYS.HISTORY) || '{}');
  hist[dateStr] = assignment; // { name: menu }
  localStorage.setItem(LS_KEYS.HISTORY, JSON.stringify(hist));
}

// ---------- DOM ì—˜ë¦¬ë¨¼íŠ¸ ----------
const $date = document.getElementById('date');
const $unique = document.getElementById('unique');
const $add = document.getElementById('addPerson');
const $name = document.getElementById('personName');
const $people = document.getElementById('people');
const $gen = document.getElementById('generate');
const $shuffle = document.getElementById('shuffle');
const $results = document.getElementById('results');
const $menuPool = document.getElementById('menuPool');
const $resetMenu = document.getElementById('resetMenu');
const $saveMenu = document.getElementById('saveMenu');
const $todayTag = document.getElementById('todayTag');
const $clearHistory = document.getElementById('clearHistory');

let state = {
  people: loadPeople(),
  menuPool: loadMenuPool()
};

// ---------- ì´ˆê¸° ì„¤ì • ----------
(function init(){
  // í•œêµ­ ì‹œê°„ ê¸°ì¤€ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ê¸°ë³¸ê°’ ì„¤ì •
  const now = new Date();
  const tzOffset = now.getTimezoneOffset();
  // ê°•ì œ Asia/Seoul(UTC+9) ë³´ì •: ë¸Œë¼ìš°ì €ê°€ ë‹¤ë¥¸ íƒ€ì„ì¡´ì´ì–´ë„ YYYY-MM-DDëŠ” í˜„ì§€ë¡œ í‘œì‹œë¨
  const seoulOffsetMin = -9*60; // getTimezoneOffsetì€ UTC-ë¡œ ìŒìˆ˜
  const d = new Date(now.getTime() + (seoulOffsetMin - tzOffset)*60000);
  $date.value = d.toISOString().slice(0,10);

  renderPeople();
  $menuPool.value = state.menuPool.join(', ');
  updateTodayTag();
})();

function updateTodayTag(){
  const ds = $date.value; if(!ds){ $todayTag.textContent='ë‚ ì§œ ë¯¸ì§€ì •'; return }
  const weekday = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][new Date(ds+'T00:00:00').getDay()];
  $todayTag.textContent = `${ds} (${weekday})`;
}

// ---------- ì‚¬ëŒ ê´€ë¦¬ ----------
function renderPeople(){
  $people.innerHTML = '';
  state.people.forEach((p,i)=>{
    const li = document.createElement('li');
    li.className='pill';
    li.innerHTML = `<span>ğŸ‘¤ ${p}</span> <button title="ì‚­ì œ" aria-label="${p} ì‚­ì œ">âœ•</button>`;
    li.querySelector('button').addEventListener('click',()=>{
      state.people.splice(i,1); savePeople(state.people); renderPeople();
    });
    $people.appendChild(li);
  })
}
$add.addEventListener('click', ()=>{
  const v = $name.value.trim(); if(!v) return;
  if(state.people.includes(v)) { alert('ì´ë¯¸ ì¶”ê°€ëœ ì´ë¦„ì…ë‹ˆë‹¤.'); return; }
  state.people.push(v); savePeople(state.people); renderPeople(); $name.value=''; $name.focus();
});
$name.addEventListener('keydown', e=>{ if(e.key==='Enter') $add.click(); })

// ---------- ë©”ë‰´ í’€ ê´€ë¦¬ ----------
$resetMenu.addEventListener('click', ()=>{
  if(confirm('ê¸°ë³¸ ë©”ë‰´ë¡œ ë˜ëŒë¦´ê¹Œìš”? í˜„ì¬ ë‚´ìš©ì€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.')){
    state.menuPool = DEFAULT_MENUS.slice();
    $menuPool.value = state.menuPool.join(', ');
    saveMenuPool(state.menuPool);
  }
});
$saveMenu.addEventListener('click', ()=>{
  const txt = $menuPool.value;
  const arr = txt.split(/[\n,]/).map(s=>s.trim()).filter(Boolean);
  if(arr.length < 5){ alert('ë©”ë‰´ëŠ” ìµœì†Œ 5ê°œ ì´ìƒì´ ì¢‹ìŠµë‹ˆë‹¤.'); return; }
  state.menuPool = Array.from(new Set(arr));
  saveMenuPool(state.menuPool);
  alert('ë©”ë‰´ í’€ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
});

// ---------- ë°°ì • ë¡œì§ ----------
function assignMenus(dateStr, people, menuPool, unique){
  if(!people.length) return {};
  if(unique && menuPool.length < people.length){
    // ë©”ë‰´ê°€ ë¶€ì¡±í•˜ë©´ ìë™ìœ¼ë¡œ non-uniqueë¡œ
    unique = false;
  }
  const seedStr = `${dateStr}|${people.join(',')}|v1`;
  const shuffledMenus = seededShuffle(menuPool, seedStr);
  const shuffledPeople = seededShuffle(people, seedStr+'people');
  const out = {};
  if(unique){
    for(let i=0;i<shuffledPeople.length;i++){
      out[shuffledPeople[i]] = shuffledMenus[i % shuffledMenus.length];
    }
  }else{
    // ì‚¬ëŒë§ˆë‹¤ ê³ ìœ í•œ ê°œì¸ ì‹œë“œë¡œ ë½‘ê¸°
    for(const name of shuffledPeople){
      const m = seededShuffle(menuPool, seedStr+'@'+name)[0];
      out[name] = m;
    }
  }
  return out;
}

function renderResults(map){
  $results.innerHTML='';
  const names = Object.keys(map);
  if(!names.length){
    $results.innerHTML = '<div class="muted">ì‚¬ëŒì„ ì¶”ê°€í•œ ë’¤ ë©”ë‰´ë¥¼ ë½‘ì•„ë³´ì„¸ìš”.</div>';
    return;
  }
  names.sort();
  for(const n of names){
    const div = document.createElement('div');
    div.className='result';
    div.innerHTML = `<h3>ğŸ‘¤ ${n}</h3><div style="font-size:18px;font-weight:800">ğŸ½ï¸ ${map[n]}</div>`;
    $results.appendChild(div);
  }
}

function generate(nowShuffle=false){
  const ds = $date.value; if(!ds){ alert('ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.'); return; }
  updateTodayTag();
  const people = state.people.slice();
  if(!people.length){ alert('ì‚¬ëŒì„ í•œ ëª… ì´ìƒ ì¶”ê°€í•˜ì„¸ìš”.'); return; }
  const unique = $unique.checked;
  // ì…”í”Œ ë²„íŠ¼ì€ ë™ì¼ ë‚ ì§œì—ì„œ ì¬ì…”í”Œí•˜ë„ë¡ seedì— ì¶”ê°€ í† í°
  const extra = nowShuffle ? ('#'+Math.random().toString(36).slice(2)) : '';
  const map = assignMenus(ds+extra, people, state.menuPool, unique);
  renderResults(map);
  saveHistory(ds, map);
}

$gen.addEventListener('click', ()=> generate(false));
$shuffle.addEventListener('click', ()=> generate(true));
$date.addEventListener('change', ()=> generate(false));
$unique.addEventListener('change', ()=> generate(false));
$clearHistory.addEventListener('click', ()=>{
  if(confirm('ì €ì¥ëœ ë‚ ì§œë³„ ê²°ê³¼ ê¸°ë¡ì„ ì§€ìš¸ê¹Œìš”?')){
    localStorage.removeItem(LS_KEYS.HISTORY);
    alert('ê¸°ë¡ì„ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.');
  }
});

// ì²« ë Œë”
renderResults({});
</script>
</body>
</html>
