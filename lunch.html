<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì ì‹¬ ë©”ë‰´ ì„ íƒê¸°</title>
  <style>
    /* ... (ìŠ¤íƒ€ì¼ ë™ì¼, ìƒëµ) ... */
  </style>
</head>
<body>
  <div class="container">
    <!-- ... (ìƒë‹¨ ë ˆì´ì•„ì›ƒ ë™ì¼, ìƒëµ) ... -->
  </div>

  <script>
    // --- ê¸°ë³¸ ë°ì´í„°
    const TYPES = ["í•œì‹","ì¤‘ì‹","ì¼ì‹","ë¶„ì‹","ì–‘ì‹","ì•„ì‹œì•ˆ","ì¹´í˜/ë””ì €íŠ¸","ê¸°íƒ€"];

    const DEFAULT_MENUS = [
      {name:"ê¹€ì¹˜ì°Œê°œ", price:9000, spicy:2, type:"í•œì‹", speed:"normal", tags:["êµ­ë°¥", "íšŒì‚¬ì•"]},
      {name:"ëœì¥ì°Œê°œ", price:9000, spicy:0, type:"í•œì‹", speed:"normal", tags:["êµ­ë°¥"]},
      {name:"ë¹„ë¹”ë°¥", price:9000, spicy:1, type:"í•œì‹", speed:"normal", tags:["ì±„ì‹ ì˜µì…˜"]},
      {name:"ë¼ì§€ë¶ˆê³ ê¸°ë®ë°¥", price:9500, spicy:1, type:"í•œì‹", speed:"quick", tags:["ë®ë°¥"]},
      {name:"ì¹¼êµ­ìˆ˜", price:8500, spicy:0, type:"í•œì‹", speed:"normal", tags:["ë©´"]},
      {name:"ëƒ‰ë©´", price:10000, spicy:1, type:"í•œì‹", speed:"quick", tags:["ì—¬ë¦„"]},
      {name:"ì§œì¥ë©´", price:8000, spicy:0, type:"ì¤‘ì‹", speed:"quick", tags:["ë©´", "ë°°ë‹¬"]},
      {name:"ì§¬ë½•", price:9000, spicy:2, type:"ì¤‘ì‹", speed:"normal", tags:["ë©´"]},
      {name:"ë§ˆë¼íƒ•", price:11000, spicy:3, type:"ì¤‘ì‹", speed:"normal", tags:["ë§ˆë¼"]},
      {name:"ëœì¥ë¼ë©˜", price:11000, spicy:1, type:"ì¼ì‹", speed:"normal", tags:["ë¼ë©˜"]},
      {name:"ëˆì¹´ì¸ ", price:12000, spicy:0, type:"ì¼ì‹", speed:"normal", tags:["ì •ì‹"]},
      {name:"ê·œë™", price:9500, spicy:0, type:"ì¼ì‹", speed:"quick", tags:["ë®ë°¥"]},
      {name:"ê¹€ë°¥", price:4000, spicy:0, type:"ë¶„ì‹", speed:"quick", tags:["ê°€ì„±ë¹„", "í¬ì¥"]},
      {name:"ë¼ë³¶ì´", price:7000, spicy:2, type:"ë¶„ì‹", speed:"quick", tags:["ë¶„ì‹"]},
      {name:"íŒŒìŠ¤íƒ€", price:13000, spicy:0, type:"ì–‘ì‹", speed:"normal", tags:["ë©´"]},
      {name:"í”¼ì 1ì¡°ê°", price:5500, spicy:0, type:"ì–‘ì‹", speed:"quick", tags:["ìŠ¬ë¼ì´ìŠ¤"]},
      {name:"ìŒ€êµ­ìˆ˜", price:11000, spicy:1, type:"ì•„ì‹œì•ˆ", speed:"normal", tags:["ë©´"]},
      {name:"íŒŸíƒ€ì´", price:11000, spicy:1, type:"ì•„ì‹œì•ˆ", speed:"normal", tags:["ë³¶ìŒë©´"]},
      {name:"ìƒëŸ¬ë“œ", price:9500, spicy:0, type:"ê¸°íƒ€", speed:"quick", tags:["ê°€ë²¼ì›€", "ì±„ì‹"]},
      {name:"ì•„ë©”ë¦¬ì¹´ë…¸", price:2500, spicy:0, type:"ì¹´í˜/ë””ì €íŠ¸", speed:"quick", tags:["ì»¤í”¼", "í›„ì‹"]}
    ];

    // --- Storage helpers
    const LS_KEY = "lunch.menus.v1";
    const LS_HIST = "lunch.history.v1";

    const loadMenus = () => {
      try {
        const raw = localStorage.getItem(LS_KEY);
        return raw ? JSON.parse(raw) : DEFAULT_MENUS;
      } catch { return DEFAULT_MENUS; }
    }
    const saveMenus = (menus) => localStorage.setItem(LS_KEY, JSON.stringify(menus));

    const loadHist = () => {
      try { return JSON.parse(localStorage.getItem(LS_HIST) || "[]"); } catch { return []; }
    }
    const saveHist = (hist) => localStorage.setItem(LS_HIST, JSON.stringify(hist.slice(0, 24)));

    // --- DOM refs
    const listEl = document.getElementById('list');
    const countEl = document.getElementById('count');
    const typeChips = document.getElementById('typeChips');
    const resultEl = document.getElementById('result');
    const histEl = document.getElementById('history');
    const mapLink = document.getElementById('mapLink');

    const minPrice = document.getElementById('minPrice');
    const maxPrice = document.getElementById('maxPrice');
    const spicy = document.getElementById('spicy');
    const speed = document.getElementById('speed');
    const q = document.getElementById('q');

    const nameNew = document.getElementById('name');
    const priceNew = document.getElementById('price');
    const spicyNew = document.getElementById('spicyNew');
    const typeNew = document.getElementById('typeNew');
    const speedNew = document.getElementById('speedNew');
    const tagsNew = document.getElementById('tagsNew');

    const btnRecommend = document.getElementById('btnRecommend');
    const btnReset = document.getElementById('btnReset');
    const btnClearAll = document.getElementById('btnClearAll');
    const btnAdd = document.getElementById('btnAdd');

    // --- Utils
    const emojiByType = (t) => ({
      'í•œì‹':'ğŸš','ì¤‘ì‹':'ğŸ¥¡','ì¼ì‹':'ğŸ±','ë¶„ì‹':'ğŸ¢','ì–‘ì‹':'ğŸ','ì•„ì‹œì•ˆ':'ğŸœ','ì¹´í˜/ë””ì €íŠ¸':'â˜•','ê¸°íƒ€':'ğŸ¥—'
    }[t] || 'ğŸ½ï¸');

    // ê°€ê²© í‘œì‹œ í—¬í¼: ìˆ«ìë©´ 1,234ì›, ì•„ë‹ˆë©´ 'ì‹œì„¸'
    function priceText(m) {
      const n = Number(m.price);
      return Number.isFinite(n) ? `${n.toLocaleString()}ì›` : 'ì‹œì„¸';
    }

    // --- State
    let MENUS = loadMenus();

    function matchesFilter(m) {
      const min = Number(minPrice.value || 0);
      const max = Number(maxPrice.value || Infinity);
      const p = Number(m.price);
      if (Number.isFinite(p)) {
        if (!(p >= min && p <= max)) return false;
      }
      if (spicy.value !== '' && Number(spicy.value) !== Number(m.spicy)) return false;
      if (speed.value && speed.value !== m.speed) return false;

      const actives = [...typeChips.querySelectorAll('.chip.active')].map(x => x.dataset.type);
      if (actives.length && !actives.includes(m.type)) return false;

      const text = (q.value || '').trim().toLowerCase();
      if (text) {
        const hay = [m.name, m.type, ...(m.tags||[])].join(' ').toLowerCase();
        if (!hay.includes(text)) return false;
      }
      return true;
    }

    function itemTemplate(m) {
      const chip = `<span class="pill">${emojiByType(m.type)} ${m.type}</span>`;
      const spicyText = ['ì•ˆ ë§¤ì›€','ì•½ê°„','ë³´í†µ','ë§¤ì›€'][m.spicy] || '-';
      const tags = (m.tags||[]).slice(0,3).map(t=>`<span class="badge">#${t}</span>`).join(' ');
      const del = `<button class="btn btn-del" data-name="${m.name}" title="ì‚­ì œ">ğŸ—‘</button>`;
      return `
        <div class="item">
          <div>
            <div style="font-weight:700">${m.name} <span class="badge">${priceText(m)}</span> <span class="badge">${spicyText}</span></div>
            <div style="display:flex; gap:8px; align-items:center; margin-top:6px; flex-wrap:wrap">
              ${chip} ${tags}
            </div>
          </div>
          <div style="display:flex; gap:6px; align-items:center">
            <a class="btn" target="_blank" rel="noopener" href="https://www.google.com/maps/search/${encodeURIComponent(m.name)}">ì§€ë„</a>
            ${del}
          </div>
        </div>`;
    }

    function renderList() {
      const data = MENUS.filter(matchesFilter);
      countEl.textContent = `${data.length}ê°œ`;
      listEl.innerHTML = data.map(m => itemTemplate(m)).join('');
      // attach delete buttons
      [...document.querySelectorAll('.btn-del')].forEach(btn => {
        btn.onclick = () => {
          const name = btn.getAttribute('data-name');
          MENUS = MENUS.filter(x => x.name !== name);
          saveMenus(MENUS);
          filterAndRender();
        };
      });
    }

    function filterAndRender() {
      renderList();
    }

    function pickOne() {
      const pool = MENUS.filter(matchesFilter);
      if (!pool.length) return null;
      const mid = (Number(minPrice.value||0) + Number(maxPrice.value||12000)) / 2;
      const weights = pool.map(m => {
        const pnum = Number(m.price);
        const priceScore = Number.isFinite(pnum) ? 1 / (1 + Math.abs((pnum - mid)) / 4000) : 0.9;
        const speedScore = (m.speed === 'quick') ? 1.15 : 1.0;
        return Math.max(0.2, priceScore * speedScore);
      });
      const sum = weights.reduce((a,b)=>a+b,0);
      let r = Math.random() * sum;
      for (let i=0;i<pool.length;i++) { r -= weights[i]; if (r<=0) return pool[i]; }
      return pool[pool.length-1];
    }

    function showResult(m, reason='') {
      if (!m) {
        resultEl.innerHTML = `<div class="name">ì¡°ê±´ì— ë§ëŠ” ë©”ë‰´ê°€ ì—†ì–´ìš” ğŸ˜¢</div><div class="why">í•„í„°ë¥¼ ë„“í˜€ë³´ì„¸ìš”.</div>`;
        return;
      }
      const spicyText = ['ì•ˆ ë§¤ì›€','ì•½ê°„','ë³´í†µ','ë§¤ì›€'][m.spicy] || '-';
      resultEl.innerHTML = `
        <div class="fade">
          <div class="name">${emojiByType(m.type)} ${m.name}</div>
          <div class="why">${m.type} Â· ${spicyText} Â· ${priceText(m)}</div>
        </div>`;
      mapLink.href = `https://www.google.com/maps/search/${encodeURIComponent(m.name)}`;
      const hist = loadHist();
      hist.unshift(m.name);
      saveHist(hist);
      renderHistory();
    }

    function renderHistory() {
      const hist = loadHist();
      histEl.innerHTML = hist.slice(0, 12).map(h => `<span class="chip">${h}</span>`).join('');
    }

    // --- Event wiring
    btnRecommend.onclick = () => showResult(pickOne());
    btnReset.onclick = () => {
      minPrice.value = '';
      maxPrice.value = '';
      spicy.value = '';
      speed.value = '';
      q.value = '';
      [...typeChips.children].forEach(c => c.classList.remove('active'));
      filterAndRender();
      resultEl.innerHTML = `<div class="name">ë¬´ì—‡ì„ ë“œì‹¤ê¹Œìš”? ğŸ™‚</div><div class="why">í•„í„°ë¥¼ ì¡°ì •í•˜ê±°ë‚˜ ë°”ë¡œ ì¶”ì²œì„ ëˆŒëŸ¬ë³´ì„¸ìš”.</div>`;
    };

    btnClearAll.onclick = () => {
      if (!confirm('ëª¨ë“  ë©”ë‰´ì™€ ê¸°ë¡ì„ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
      localStorage.removeItem(LS_KEY);
      localStorage.removeItem(LS_HIST);
      MENUS = DEFAULT_MENUS.slice();
      renderHistory();
      filterAndRender();
    };

    btnAdd.onclick = () => {
      const nm = (nameNew.value||'').trim();
      const pr = Number(priceNew.value||0);
      if (!nm) return alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
      if (MENUS.some(m => m.name === nm)) return alert('ë™ì¼í•œ ì´ë¦„ì˜ ë©”ë‰´ê°€ ì´ë¯¸ ìˆì–´ìš”');
      const item = {
        name: nm,
        price: Number.isFinite(pr) && pr > 0 ? pr : null,
        spicy: Number(spicyNew.value||0),
        type: typeNew.value,
        speed: speedNew.value,
        tags: (tagsNew.value||'').split(',').map(s=>s.trim()).filter(Boolean)
      };
      MENUS.push(item);
      saveMenus(MENUS);
      nameNew.value = priceNew.value = tagsNew.value = '';
      spicyNew.value = '0';
      filterAndRender();
    };

    [minPrice,maxPrice,spicy,speed,q].forEach(el => el.addEventListener('input', filterAndRender));

    function renderTypeChips() {
      typeChips.innerHTML = '';
      TYPES.forEach(t => {
        const c = document.createElement('button');
        c.className = 'chip';
        c.textContent = t;
        c.setAttribute('data-type', t);
        c.onclick = () => { c.classList.toggle('active'); filterAndRender(); };
        typeChips.appendChild(c);
      });
      typeNew.innerHTML = TYPES.map(t => `<option value="${t}">${t}</option>`).join('');
    }

    function init() {
      renderTypeChips();
      renderHistory();
      filterAndRender();
    }
    init();
  </script>
</body>
</html>
