<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>점심메뉴 선택기</title>
  <style>
    :root{
      --bg:#0b1020; /* deep slate */
      --card:#121834;
      --muted:#9aa3b2;
      --text:#e9edf5;
      --accent:#7aa2ff;
      --accent-2:#9ef0c0;
      --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg, #0b1020, #0a0f1a 40%, #0b1020);
      color:var(--text); font-family:-apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo','Noto Sans KR', Segoe UI, Roboto, Helvetica, Arial, "맑은 고딕", sans-serif;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .app{width:min(980px, 100%);}
    .card{
      background:rgba(18,24,52,.9); border:1px solid rgba(255,255,255,.06);
      box-shadow:0 10px 30px rgba(0,0,0,.4); border-radius:24px; padding:20px; backdrop-filter: blur(8px);
    }
    header{display:flex; align-items:center; gap:16px; flex-wrap:wrap;}
    h1{font-size:clamp(20px, 2vw + 12px, 32px); margin:0; letter-spacing:.2px}
    .sub{color:var(--muted); font-size:14px}

    .result{
      margin:18px 0 12px; background:linear-gradient(135deg, #1c244d, #0e1430);
      border:1px solid rgba(255,255,255,.06); border-radius:20px; padding:22px;
      display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap;
    }
    .picked{font-size:clamp(28px, 4vw + 8px, 44px); font-weight:800; letter-spacing:.5px}
    .hint{color:var(--muted); font-size:13px}

    .controls{display:flex; gap:10px; flex-wrap:wrap}
    button{
      appearance:none; border:none; cursor:pointer; border-radius:14px; padding:12px 16px; font-weight:700; color:#0b1020;
      transition:transform .04s ease, filter .2s ease, box-shadow .2s ease; box-shadow:0 6px 16px rgba(0,0,0,.25);
    }
    button:hover{filter:brightness(1.05)}
    button:active{transform:translateY(1px)}
    .primary{background:var(--accent)}
    .secondary{background:var(--accent-2)}
    .ghost{background:#e4ecff; color:#102040}
    .danger{background:var(--danger); color:white}

    .layout{display:grid; grid-template-columns: 1.2fr .8fr; gap:16px; margin-top:12px}
    @media (max-width: 860px){ .layout{grid-template-columns:1fr} }

    .panel{background:rgba(18,24,52,.7); border:1px solid rgba(255,255,255,.06); border-radius:18px; padding:16px}
    .panel h3{margin:0 0 12px; font-size:16px; color:#cbd6ff}

    .menu-list{display:grid; grid-template-columns:repeat(auto-fill, minmax(180px,1fr)); gap:10px}
    .item{
      display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px; background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.06);
    }
    .item input{accent-color:var(--accent)}

    .toolbar{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px}

    .history{display:flex; flex-direction:column; gap:8px}
    .pill{display:inline-flex; align-items:center; gap:8px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); padding:8px 12px; border-radius:999px; width:fit-content}
    .pill small{color:var(--muted)}

    .kbd{border:1px solid rgba(255,255,255,.2); background:rgba(255,255,255,.06); padding:2px 6px; border-radius:6px; font-size:12px}
    .footer{color:var(--muted); font-size:12px; margin-top:8px}
    .spacer{flex:1}
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <header>
        <h1>점심메뉴 선택기</h1>
        <div class="sub">체크된 메뉴 중 하나를 랜덤으로 골라드려요. <span class="kbd">R</span> 키로도 추천!</div>
        <div class="spacer"></div>
        <div class="controls">
          <button id="btn-pick" class="primary" title="선택된 메뉴 중에서 추천">랜덤 추천</button>
          <button id="btn-reroll" class="ghost" title="방금 추천에서 다시">다시 뽑기</button>
          <button id="btn-copy" class="secondary" title="추천 결과 복사">결과 복사</button>
          <button id="btn-reset" class="danger" title="제외 초기화">제외 초기화</button>
        </div>
      </header>

      <section class="result">
        <div>
          <div class="picked" id="picked">메뉴를 골라볼까요? 🍽️</div>
          <div class="hint">체크 박스로 제외/포함을 조정할 수 있어요.</div>
        </div>
      </section>

      <div class="layout">
        <section class="panel">
          <div class="toolbar">
            <button id="btn-all" class="ghost">전체 선택</button>
            <button id="btn-none" class="ghost">전체 해제</button>
            <button id="btn-invert" class="ghost">선택 반전</button>
          </div>
          <h3>메뉴 목록</h3>
          <div class="menu-list" id="menu-list"></div>
          <div class="footer">체크된 항목만 후보에 포함됩니다.</div>
        </section>

        <section class="panel">
          <h3>히스토리</h3>
          <div class="history" id="history"></div>
          <div class="footer">최근 10개까지 저장됩니다(브라우저 로컬 저장소).</div>
        </section>
      </div>
    </div>
  </div>

  <script>
    const MENUS = [
      '칼국수','광화문 김치찌개','제주 김치찌게','뼈다귀해장국','콩나물국밥','황태해장국','구룡','삼산국수','부산밀면','콩국수','분식','맥도날드','홍익돈까스'
    ];

    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));

    const listEl = $('#menu-list');
    const pickedEl = $('#picked');
    const historyEl = $('#history');

    const LS_KEYS = {
      checked: 'lunchpicker.checked',
      history: 'lunchpicker.history'
    };

    function loadChecked(){
      try{ return JSON.parse(localStorage.getItem(LS_KEYS.checked)) ?? null }catch{ return null }
    }
    function saveChecked(state){
      localStorage.setItem(LS_KEYS.checked, JSON.stringify(state));
    }
    function loadHistory(){
      try{ return JSON.parse(localStorage.getItem(LS_KEYS.history)) ?? [] }catch{ return [] }
    }
    function saveHistory(hist){
      localStorage.setItem(LS_KEYS.history, JSON.stringify(hist.slice(0,10)));
    }

    function renderList(){
      const saved = loadChecked();
      listEl.innerHTML = '';
      MENUS.forEach((name, i)=>{
        const id = 'm_'+i;
        const item = document.createElement('label');
        item.className = 'item';
        item.innerHTML = `
          <input type="checkbox" id="${id}" ${(!saved || saved[i] !== false) ? 'checked' : ''} />
          <span>${name}</span>
        `;
        listEl.appendChild(item);
      });
      // Persist on change
      listEl.addEventListener('change', persistChecked, {once:true});
    }

    function persistChecked(){
      const states = $$('.item input', listEl).map(chk => chk.checked);
      saveChecked(states);
      // reattach after first event listener is consumed
      listEl.addEventListener('change', persistChecked, {once:true});
    }

    function getSelected(){
      return $$('.item', listEl)
        .map((el, i)=>({name: MENUS[i], checked: $('input', el).checked}))
        .filter(x=>x.checked)
        .map(x=>x.name);
    }

    function animatePick(candidates, final){
      const duration = 1000; // ms
      const start = performance.now();
      let raf;
      function step(t){
        const p = Math.min(1, (t - start) / duration);
        // Ease-out
        const eased = 1 - Math.pow(1 - p, 3);
        const idx = Math.floor(eased * 24) % candidates.length;
        pickedEl.textContent = candidates[idx] + '…';
        if(p < 1){ raf = requestAnimationFrame(step); }
        else { pickedEl.textContent = final; }
      }
      cancelAnimationFrame(raf);
      raf = requestAnimationFrame(step);
    }

    function pick(){
      const candidates = getSelected();
      if(candidates.length === 0){
        alert('선택된 메뉴가 없습니다. 체크박스에서 후보를 선택하세요.');
        return null;
      }
      const i = Math.floor(Math.random() * candidates.length);
      const choice = candidates[i];
      animatePick(candidates, choice);
      return choice;
    }

    function addHistory(item){
      if(!item) return;
      const hist = loadHistory();
      const ts = new Date();
      hist.unshift({ item, ts: ts.toISOString() });
      saveHistory(hist);
      renderHistory();
    }

    function renderHistory(){
      const hist = loadHistory();
      historyEl.innerHTML = '';
      hist.forEach(h => {
        const d = new Date(h.ts);
        const el = document.createElement('div');
        el.className = 'pill';
        el.innerHTML = `<strong>${h.item}</strong><small>${d.toLocaleString('ko-KR')}</small>`;
        historyEl.appendChild(el);
      });
    }

    // Controls
    $('#btn-pick').addEventListener('click', ()=>{
      const c = pick();
      addHistory(c);
    });
    $('#btn-reroll').addEventListener('click', ()=>{
      const candidates = getSelected();
      if(candidates.length === 0) return alert('선택된 메뉴가 없습니다.');
      const prev = pickedEl.textContent.replace('…','');
      let next = prev;
      if(candidates.length === 1){ next = candidates[0]; }
      else{
        while(next === prev){ next = candidates[Math.floor(Math.random()*candidates.length)]; }
      }
      animatePick(candidates, next);
      addHistory(next);
    });
    $('#btn-copy').addEventListener('click', async ()=>{
      const txt = pickedEl.textContent.trim();
      if(!txt || txt.includes('메뉴를 골라볼까요')) return alert('아직 추천된 결과가 없습니다.');
      try{ await navigator.clipboard.writeText(txt); alert('복사되었습니다: '+txt) }catch{ alert('복사에 실패했습니다. 수동으로 복사해 주세요.'); }
    });
    $('#btn-reset').addEventListener('click', ()=>{
      if(!confirm('제외 상태를 초기화할까요? 모든 메뉴가 다시 포함됩니다.')) return;
      localStorage.removeItem(LS_KEYS.checked);
      renderList();
    });

    $('#btn-all').addEventListener('click', ()=>{
      $$('.item input', listEl).forEach(i=>i.checked = true);
      persistChecked();
    });
    $('#btn-none').addEventListener('click', ()=>{
      $$('.item input', listEl).forEach(i=>i.checked = false);
      persistChecked();
    });
    $('#btn-invert').addEventListener('click', ()=>{
      $$('.item input', listEl).forEach(i=>i.checked = !i.checked);
      persistChecked();
    });

    // Keyboard shortcut: R to pick
    document.addEventListener('keydown', (e)=>{
      if(e.key.toLowerCase() === 'r'){ $('#btn-pick').click(); }
    });

    // Init
    renderList();
    renderHistory();
  </script>
</body>
</html>
