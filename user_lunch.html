<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>[ì‚¬ìš©ììš©] ì ì‹¬ë©”ë‰´ ì œì¶œ â€” 1ì¸ 3ê°œ ì…ë ¥ Â· í† í° ìƒì„±</title>
<style>
  :root{--bg:#0b0d12;--card:#111520;--mut:#2a2f3a;--text:#e8ecf3;--sub:#8b95a7;--acc:#4da3ff}
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b0d12,#0f1320);color:var(--text);
       font:15.5px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Noto Sans KR,sans-serif}
  .wrap{max-width:720px;margin:28px auto;padding:0 16px}
  h1{font-size:22px;margin:0 0 8px}
  .card{background:var(--card);border:1px solid var(--mut);border-radius:16px;padding:14px;margin-top:12px}
  label{font-weight:700}
  input[type="date"],input[type="text"],textarea{width:100%;background:#0e1118;border:1px solid var(--mut);
        color:var(--text);padding:10px 12px;border-radius:12px}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .col{flex:1 1 180px}
  .btn{appearance:none;border:1px solid var(--mut);background:#121826;color:var(--text);
       padding:10px 14px;border-radius:12px;cursor:pointer;transition:.15s;font-weight:700}
  .btn:hover{transform:translateY(-1px);border-color:var(--acc)}
  .btn.primary{background:var(--acc);color:#07121e;border-color:transparent}
  .tiny{font-size:12px;color:var(--sub)}
  textarea{min-height:90px}
</style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ± [ì‚¬ìš©ììš©] ì ì‹¬ë©”ë‰´ ì œì¶œ</h1>
  <div class="tiny">ì´ë¦„ê³¼ ë©”ë‰´ 3ê°œë¥¼ ì…ë ¥ â†’ â€œì œì¶œ í† í° ë§Œë“¤ê¸°â€ â†’ ë³µì‚¬í•´ì„œ ê´€ë¦¬ìì—ê²Œ ì „ë‹¬í•˜ì„¸ìš”.</div>

  <section class="card">
    <div class="row">
      <div class="col"><label for="name">ì´ë¦„</label><input id="name" type="text" placeholder="ë³¸ì¸ ì´ë¦„"></div>
      <div class="col"><label for="date">ë‚ ì§œ</label><input id="date" type="date"><div id="todayTag" class="tiny"></div></div>
    </div>
    <div class="row" style="margin-top:8px">
      <div class="col"><label for="m1">ë©”ë‰´ 1</label><input id="m1" type="text" list="suggest" placeholder="ì˜ˆ: ê¹€ì¹˜ì°Œê°œ"></div>
      <div class="col"><label for="m2">ë©”ë‰´ 2</label><input id="m2" type="text" list="suggest" placeholder="ì˜ˆ: íŒŒìŠ¤íƒ€"></div>
      <div class="col"><label for="m3">ë©”ë‰´ 3</label><input id="m3" type="text" list="suggest" placeholder="ì˜ˆ: ì´ˆë°¥"></div>
    </div>
    <datalist id="suggest"></datalist>
    <div class="row" style="margin-top:12px">
      <button id="make" class="btn primary">ì œì¶œ í† í° ë§Œë“¤ê¸°</button>
      <button id="clear" class="btn">ì…ë ¥ ë¹„ìš°ê¸°</button>
      <label class="tiny" style="display:flex;align-items:center;gap:6px"><input id="saveLocal" type="checkbox" checked>ì´ ì…ë ¥ì„ ì´ ë¸Œë¼ìš°ì €ì— ì €ì¥</label>
    </div>
  </section>

  <section class="card">
    <label for="token">ì œì¶œ í† í°</label>
    <textarea id="token" readonly placeholder="ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤. ë³µì‚¬í•´ì„œ ì œì¶œí•˜ì„¸ìš”."></textarea>
    <div class="row" style="margin-top:8px">
      <button id="copy" class="btn">í† í° ë³µì‚¬</button>
      <button id="download" class="btn">í† í° .txt ì €ì¥</button>
    </div>
    <div class="tiny" style="margin-top:6px">í˜•ì‹: Base64(JSON). ê´€ë¦¬ì í˜ì´ì§€(lunch_admin.html)ì— ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ìœ¼ë©´ ì²˜ë¦¬ë©ë‹ˆë‹¤.</div>
  </section>
</div>

<script>
/* ===== ê¸°ë³¸ ë©”ë‰´ ì œì•ˆ ===== */
const DEFAULT_MENUS = ["ê¹€ì¹˜ì°Œê°œ","ëœì¥ì°Œê°œ","ë¹„ë¹”ë°¥","ë¶ˆê³ ê¸°","ì œìœ¡ë³¶ìŒ","ëƒ‰ë©´","ì¹¼êµ­ìˆ˜","ê¹€ë°¥","ë–¡ë³¶ì´","ìˆœëŒ€êµ­",
  "ë¶€ëŒ€ì°Œê°œ","ê°ìíƒ•","ì¹˜í‚¨","í”¼ì","íŒŒìŠ¤íƒ€","í–„ë²„ê±°","ìƒëŸ¬ë“œ","ì´ˆë°¥","ëˆì¹´ì¸ ","ë¼ë©˜","ìš°ë™",
  "ì§œì¥ë©´","ì§¬ë½•","íƒ•ìˆ˜ìœ¡","ë§ˆë¼íƒ•","ìŒ€êµ­ìˆ˜","íŒŸíƒ€ì´","ì¹´ë ˆ","ê·œë™","í¬ì¼€","ìˆœë‘ë¶€ì°Œê°œ","í•´ì¥êµ­",
  "ë³¶ìŒë°¥","ê°ˆë¹„íƒ•","ì„¤ë íƒ•","ì½©ë‚˜ë¬¼êµ­ë°¥","ë©”ë°€êµ­ìˆ˜"];

/* ===== Base64 UTF-8 ===== */
function b64encodeUtf8(s){return btoa(unescape(encodeURIComponent(s)));}

/* ===== ë‚ ì§œ ê¸°ë³¸ê°’(Seoul) ===== */
const $date=document.getElementById('date');
const $todayTag=document.getElementById('todayTag');
(function initDate(){
  const now=new Date(); const tz=now.getTimezoneOffset(); const seoul=-9*60;
  const d=new Date(now.getTime() + (seoul - tz)*60000);
  $date.value = d.toISOString().slice(0,10);
  updateTodayTag();
})();
function updateTodayTag(){
  const ds=$date.value; if(!ds){ $todayTag.textContent='ë‚ ì§œ ë¯¸ì§€ì •'; return }
  const wd=['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][new Date(ds+'T00:00:00').getDay()];
  $todayTag.textContent = `${ds} (${wd})`;
}

/* ===== DOM ===== */
const $name=document.getElementById('name');
const $m1=document.getElementById('m1');
const $m2=document.getElementById('m2');
const $m3=document.getElementById('m3');
const $make=document.getElementById('make');
const $clear=document.getElementById('clear');
const $token=document.getElementById('token');
const $copy=document.getElementById('copy');
const $download=document.getElementById('download');
const $saveLocal=document.getElementById('saveLocal');
const $suggest=document.getElementById('suggest');

/* ===== datalist ì±„ìš°ê¸° ===== */
DEFAULT_MENUS.forEach(m=>{ const o=document.createElement('option'); o.value=m; $suggest.appendChild(o); });

/* ===== ë¡œì»¬ ì €ì¥ ===== */
const LS='lunch_user_last';
(function loadLocal(){
  try{
    const o=JSON.parse(localStorage.getItem(LS)||'null');
    if(o){ $name.value=o.name||''; $m1.value=o.p1||''; $m2.value=o.p2||''; $m3.value=o.p3||''; $date.value=o.date||$date.value; updateTodayTag(); }
  }catch(_){}
})();
function maybeSave(){
  if(!$saveLocal.checked) return;
  const o={name:$name.value,date:$date.value,p1:$m1.value,p2:$m2.value,p3:$m3.value};
  localStorage.setItem(LS, JSON.stringify(o));
}

/* ===== ìœ í‹¸ ===== */
function trim(s){return String(s||'').trim();}

/* ===== ì´ë²¤íŠ¸ ===== */
[$name,$m1,$m2,$m3,$date].forEach(el=> el.addEventListener('change', maybeSave));

$clear.addEventListener('click', ()=>{
  $m1.value=$m2.value=$m3.value=''; maybeSave(); $token.value='';
});

$make.addEventListener('click', ()=>{
  const name=trim($name.value);
  const date=trim($date.value);
  const picks=[trim($m1.value),trim($m2.value),trim($m3.value)];
  if(!name){ alert('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  if(!date){ alert('ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.'); return; }
  if(picks.some(x=>!x)){ alert('ë©”ë‰´ 3ê°œë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  const payload={version:'v1', name, date, picks};
  const token = b64encodeUtf8(JSON.stringify(payload));
  $token.value = token;
  maybeSave();
});

$copy.addEventListener('click', async ()=>{
  if(!$token.value){ alert('ë¨¼ì € í† í°ì„ ìƒì„±í•˜ì„¸ìš”.'); return; }
  try{ await navigator.clipboard.writeText($token.value); alert('í† í°ì„ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤.'); }catch(_){}
});

$download.addEventListener('click', ()=>{
  if(!$token.value){ alert('ë¨¼ì € í† í°ì„ ìƒì„±í•˜ì„¸ìš”.'); return; }
  const blob = new Blob([$token.value+'\n'], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download=`lunch_token_${$name.value||'noname'}.txt`; a.click();
  URL.revokeObjectURL(url);
});
</script>
</body>
</html>
